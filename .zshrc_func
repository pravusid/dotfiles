RED='\033[0;31m'
YELLOW='\033[0;33m'
NC='\033[0m'

mpeg-dn() {
  ffmpeg -i "$1" -c copy -bsf:a aac_adtstoasc "$2"
}

portconn() {
  grep -v "rem_address" /proc/net/tcp |
    awk 'function hextodec(str,ret,n,i,k,c) {
      ret = 0
      n = length(str)
      for (i = 1; i <= n; i++) {
        c = tolower(substr(str, i, 1))
        k = index("123456789abcdef", c)
        ret = ret * 16 + k
      }
      return ret
    } {
      x=hextodec(substr($2,index($2,":")-2,2));
      for (i=5; i>0; i-=2) x = x"."hextodec(substr($2,i,2))
    } {
      print x":"hextodec(substr($2,index($2,":")+1,4))
    }' |
    sort | uniq -c | sort -rn
}

kp() {
  lsof -ti :$1 | xargs -r -I {} kill -9 {}
  echo "${RED}kill port $1${NC}"
}

# https://pravusid.kr/wiki/Docker/docker-volume.html
docker-vol() {
  if [[ $1 == "ls" ]]; then
    docker ps -a --format '{{ .ID }}' |
      xargs -I {} docker inspect -f '{{ .Name }}{{ range .Mounts }}{{ printf "\n\t" }}{{ .Type }} {{ if eq .Type "bind" }}{{ .Source }}{{ end }}{{ .Name }} => {{ .Destination }}{{ end }}{{ printf "\n" }}' {}
  elif [[ $1 == "clean" ]]; then
    docker volume rm $(docker volume ls -qf dangling=true)
  else
    echo "unknown command"
  fi
}

fd-nm() {
  echo -e "${YELLOW}fd -H -I -t d --prune \"node_modules\"${NC}"
  fd -H -I -t d --prune "node_modules"
}

# https://help.dropbox.com/sync/ignored-files

dropbox-ignore() {
  if [[ $(uname) == "Linux" ]]; then
    attr -s com.dropbox.ignored -V 1 $1
  elif [[ $(uname) == "Darwin" ]]; then
    xattr -w "com.apple.fileprovider.ignore#P" 1 $1
  fi
}

dropbox-unignore() {
  if [[ $(uname) == "Linux" ]]; then
    attr -r com.dropbox.ignored $1
  elif [[ $(uname) == "Darwin" ]]; then
    xattr -d "com.apple.fileprovider.ignore#P" $1
  fi
}

du-sorted() {
  echo -e "${YELLOW}du -kh -d1 | sort -rh${NC}"
  du -kh -d1 | sort -rh
}
